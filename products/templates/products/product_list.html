<!-- templates/products/product_list.html -->
{% extends 'base.html' %} {% load static %} {% block title %}Products - HagerBet{% endblock %} {% block content %}
<div class="container mx-auto px-4 py-8">
  <!-- Page Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">
      {% if search_query %}Search Results for "{{ search_query }}"{% elif selected_category %}{{ selected_category|title }}{% else %}All Products{% endif %}
    </h1>
    <p class="text-gray-600">{{ products.paginator.count }} products found</p>
  </div>

  <div class="flex flex-col lg:flex-row gap-8">
    <!-- Sidebar Filters -->
    <div class="lg:w-1/4">
      <div class="bg-white rounded-lg shadow-sm p-6 sticky top-24">
        <!-- Search Box -->
        <div class="mb-6">
          <form action="{% url 'products:product_search' %}" method="get">
            <input
              type="text"
              name="q"
              value="{{ search_query }}"
              placeholder="Search products..."
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
          </form>
        </div>

        <!-- Categories -->
        <div class="mb-6">
          <h3 class="font-semibold text-gray-800 mb-3">Categories</h3>
          <ul class="space-y-2">
            <li>
              <a
                href="{% url 'products:product_list' %}"
                class="block text-gray-600 hover:text-blue-600 {% if not selected_category %}text-blue-600 font-semibold{% endif %}"
              >
                All Categories
              </a>
            </li>
            {% for category in categories %}
            <li>
              <a
                href="{% url 'products:product_list' %}?category={{ category.slug }}"
                class="block text-gray-600 hover:text-blue-600 {% if selected_category == category.slug %}text-blue-600 font-semibold{% endif %}"
              >
                {{ category.name }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>

        <!-- Brands -->
        <div class="mb-6">
          <h3 class="font-semibold text-gray-800 mb-3">Brands</h3>
          <ul class="space-y-2">
            {% for brand in brands %}
            <li>
              <a
                href="{% url 'products:product_list' %}?brand={{ brand.slug }}"
                class="block text-gray-600 hover:text-blue-600"
              >
                {{ brand.name }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="lg:w-3/4">
      <!-- Sorting and View Options -->
      <div class="flex justify-between items-center mb-6">
        <div class="text-sm text-gray-600">
          Showing {{ products.start_index }}-{{ products.end_index }} of {{ products.paginator.count }} products
        </div>
      </div>

      <!-- Products -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for product in products %}
        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
          <div class="relative">
            <img
              src="{% if product.primary_image %}{{ product.primary_image.url }}{% else %}{% static 'images/placeholder.jpg' %}{% endif %}"
              alt="{{ product.name }}"
              class="w-full h-48 object-cover"
            />
            {% if product.compare_price and product.compare_price > product.price %}
            <span class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs">
              {{ product.discount_percentage }}% OFF
            </span>
            {% endif %}
            {% if product.is_featured %}
            <span class="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded text-xs">
              Featured
            </span>
            {% endif %}
          </div>

          <div class="p-4">
            <h3 class="font-semibold text-lg mb-2 truncate">
              <a href="{% url 'products:product_detail' product.slug %}" class="hover:text-blue-600">
                {{ product.name }}
              </a>
            </h3>

            <div class="flex items-center mb-2">
              <div class="text-yellow-400">★★★★☆</div>
              <span class="text-sm text-gray-600 ml-2">({{ product.review_count }})</span>
            </div>

            <div class="price-section mb-3">
              <span class="current-price text-xl font-bold text-green-600">
                ${{ product.price }}
              </span>
              {% if product.compare_price and product.compare_price > product.price %}
              <span class="original-price text-sm text-gray-500 line-through ml-2">
                ${{ product.compare_price }}
              </span>
              {% endif %}
            </div>

            <div class="flex space-x-2">
              <button
                class="add-to-cart-btn flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                data-product-id="{{ product.id }}"
                {% if not product.is_in_stock %}disabled{% endif %}
              >
                <i class="fas fa-shopping-cart mr-2"></i>
                {% if product.is_in_stock %}Add to Cart{% else %}Out of Stock{% endif %}
              </button>

              <button
                class="wishlist-toggle-btn bg-gray-200 text-gray-700 p-2 rounded hover:bg-gray-300 transition-colors"
                data-product-id="{{ product.id }}"
              >
                <i class="far fa-heart"></i>
              </button>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-span-full text-center py-12">
          <i class="fas fa-search text-gray-400 text-4xl mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-600">No products found</h3>
          <p class="text-gray-500 mt-2">Try adjusting your search or filters</p>
          <a
            href="{% url 'products:product_list' %}"
            class="inline-block mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
          >
            Browse All Products
          </a>
        </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if products.has_other_pages %}
      <div class="mt-8 flex justify-center">
        <nav class="flex items-center space-x-2">
          {% if products.has_previous %}
          <a
            href="?page={{ products.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"
            class="px-3 py-2 border border-gray-300 rounded-md text-gray-500 hover:bg-gray-50"
          >
            Previous
          </a>
          {% endif %}
          {% for num in products.paginator.page_range %}
          {% if products.number == num %}
          <span class="px-3 py-2 border border-blue-500 bg-blue-500 text-white rounded-md">
            {{ num }}
          </span>
          {% else %}
          <a
            href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}"
            class="px-3 py-2 border border-gray-300 rounded-md text-gray-500 hover:bg-gray-50"
          >
            {{ num }}
          </a>
          {% endif %}
          {% endfor %}
          {% if products.has_next %}
          <a
            href="?page={{ products.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"
            class="px-3 py-2 border border-gray-300 rounded-md text-gray-500 hover:bg-gray-50"
          >
            Next
          </a>
          {% endif %}
        </nav>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="{% static 'js/products.js' %}"></script>
<script src="{% static 'js/cart.js' %}"></script>
<script src="{% static 'js/wishlist.js' %}"></script>
{% endblock %}